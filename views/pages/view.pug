extends ../base/layout
include mixins.pug

block append styles
  - icons = ['delete','edit','add_circle','file_upload'].sort()
  link(
    href=`https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20,100,1,200&icon_names=${icons.join(',')}&display=swap` 
    rel="stylesheet")

block append content
  div(style="display:flex;justify-content:between;").flex.center_content.mb-4
    +breadcrumbs(page.slug)
    if(admin)
      div(role="group" class="flex" style="flex:1,1;")
        i(role="button" hx-get=`/tad/create` hx-target="#dialog-container" hx-swap="innerHTML" class="material-symbols-outlined")="add_circle"
        i(role="button" hx-put=`/tad/${page.id}` hx-target="#dialog-container" hx-swap="innerHTML" class="material-symbols-outlined")="edit"
        i(role="button" hx-delete=`/tad/${page.id}` hx-confirm="Are you sure you want to delete" class="material-symbols-outlined")="delete"
        label.btn(for="fileinput") Upload File
        input#fileinput(type="file" role="button" name="file" style="display:none;" class="clickable" accept=".js,.ts")
        form(id="upload" method="POST" action="/tad/upload"  hx-post="/tad/upload" hx-target="#dialog-container" hx-swap="innerHTML" style="display:inline")
          input(type="hidden" name="parent_id" value=page.id)
          input(type="hidden" name="filecontent" value="")
  div.flex.justify-between.mb-4
    div.lineh05.pbottom1
      h1.lineh05= page.name
      +libPath(page.slug)

  p= page.long_description

  case page.page_type
    when 'class'
      include viewClass
    when 'property'
      include viewProperty
    when 'method'
      include viewMethod

  h2 Examples
  if page.CodeExample
      div.border.rounded.p-4.mb-4
        h3= page.CodeExample.name
        pre.bg-gray-100.p-2.rounded
          code= page.CodeExample.public
  else
    p No examples available.


  div#dialog-container
  script.
    let uploadForm = document.querySelector('#fileinput');
    uploadForm.addEventListener('change', (event) => {
      console.log('file selected, submitting form');
      const file = event.target.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = function(e) {
          const content = e.target.result;
          document.querySelector('input[name="filecontent"]').value = content;
          document.querySelector('#upload').requestSubmit();
        };
      
        reader.readAsText(file);
      }
    });

    function augment_textarea(event) { 
        const target = event.target || event.srcElement;
        const form = target.closest && target.closest('form') || document.querySelector("#notes_form");
        if (event.key === 'Enter' && !event.shiftKey) {
            console.log("Submitting form via augment_textarea");
            event.preventDefault();
            form.requestSubmit();  
            //we give a touch of time for the form to have pulled data.
        }
    }
