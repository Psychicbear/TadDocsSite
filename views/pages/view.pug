include mixins.pug
div(id="page-details" hx-trigger="pageReload" hx-get=`/tad/view/${page.id}` hx-target="#page-details" hx-swap="outerHTML" hx-swap-oob="true")
  if admin 
    div.mb-4.editPage.hidden
      div.flex.justify-between.mb-2
        div.flex3
          h2.mbottom0 Edit Page
          small.mbottom10 (press Shift+Enter for newline, Enter to save)
        div.flex1
          button( role="button" onclick="toggleEditPage(event)").material-symbols-outlined.cancel-button cancel
      form(id="page-edit" method="PUT" hx-put=`/tad/${page.id}` hx-on:htmx:before-send="toggleEditPage(event)" hx-target="#page-details" hx-swap="outerHTML" class="mb-4").grid.grid-2col13.mtop1
        input(type="hidden" name="id" value=page.id)
        input(type="text" placeholder="Name" name="name" value=page.name onkeydown="augment_textarea(event)")
        input(type="text" placeholder="Short Description" name="short_description" value=page.short_description onkeydown="augment_textarea(event)")
        textarea#notes(name="long_description" placeholder="Long Description" onkeydown="augment_textarea(event)" rows="4" style="grid-column: span 2;")= page.long_description

  div.flex.justify-between.mb-4.viewPage
    div.lineh05.pbottom1.flex3
      h1.lineh05= page.name
      if(page.slug != '/')
        - let parts = page.slug.split('/').filter(part => part.length > 0).join('.');
        if parts.length > 0
          sub.lineh05="tad." + parts
    if admin
      - let delSlug = "/"
      case page.page_type
        when 'class': - delSlug += "classes/"
        when 'method': - delSlug += "methods/"
        when 'property': - delSlug += "properties/"
      - delSlug += page.id + "?referrer=page"
      - console.log(delSlug)
      div(role="group").flex1
        i(role="button" class="material-symbols-outlined" onclick="toggleEditPage(event)") edit
        i(role="button" id="page-delete" hx-delete=`${delSlug}` hx-confirm="Are you sure you want to delete" class="material-symbols-outlined" hx-swap="outerHTML")="delete"
  p!= mdLinks(page.long_description)

+breadcrumbs(page.slug, "true")

if page.code_example_id
  section(id="example-section" hx-trigger="load" hx-get=`/examples/${page.code_example_id}?pageId=${page.id}` hx-target="#example-section" hx-swap="outerHTML" hx-swap-oob="true")
    h3 Examples
    p Loading Example...
else
  article(id="example-section" hx-target="#example-section" hx-swap-oob="true")
    h3 Examples
    p No examples available.
    if admin
      i(role="button" onClick="this.classList.add('hidden'); document.querySelector('.add-example').classList.remove('hidden');" class="material-symbols-outlined add-example-button")="add_circle"
      article(hx-get=`/examples/add?pageId=${page.id}` hx-trigger="intersect once" hx-target=".add-example" hx-swap="outerHTML").add-example.hidden

block typeDetails
  if loadPageType
    case page.page_type
        when 'class'
            div(id="type-details" hx-trigger="load" hx-get=`/classes/view/${page.id}` hx-target="#type-details" hx-swap="outerHTML" hx-swap-oob="true")="Loading module details..."
        when 'property'
            div(id="type-details" hx-trigger="load" hx-get=`/properties/view/${page.id}` hx-target="#type-details" hx-swap="outerHTML" hx-swap-oob="true")="Loading property details..."
        when 'method'
            div(id="type-details" hx-trigger="load" hx-get=`/methods/view/${page.id}` hx-target="#type-details" hx-swap="outerHTML" hx-swap-oob="true")="Loading method details..."
        default
          - break